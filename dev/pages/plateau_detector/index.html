<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Plateau Detector · IMUDevNNTrainingLib</title><meta name="title" content="Plateau Detector · IMUDevNNTrainingLib"/><meta property="og:title" content="Plateau Detector · IMUDevNNTrainingLib"/><meta property="twitter:title" content="Plateau Detector · IMUDevNNTrainingLib"/><meta name="description" content="Documentation for IMUDevNNTrainingLib."/><meta property="og:description" content="Documentation for IMUDevNNTrainingLib."/><meta property="twitter:description" content="Documentation for IMUDevNNTrainingLib."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">IMUDevNNTrainingLib</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li class="is-active"><a class="tocitem" href>Plateau Detector</a></li><li><a class="tocitem" href="../checkpointer/">Checkpointer</a></li><li><a class="tocitem" href="../pretty_printing/">Printing</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Plateau Detector</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Plateau Detector</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/imu-dev/IMUDevNNTrainingLib.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/imu-dev/IMUDevNNTrainingLib.jl/blob/main/docs/src/pages/plateau_detector.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Plateau-detector"><a class="docs-heading-anchor" href="#Plateau-detector">Plateau detector</a><a id="Plateau-detector-1"></a><a class="docs-heading-anchor-permalink" href="#Plateau-detector" title="Permalink"></a></h1><p>It is often recommended to reduce the learning rate when the tracked loss metric has stopped improving for some period of time (for instance, in <code>Python</code>, various Neural Net libraries implement <code>ReduceLROnPlateau</code>, see <a href="https://keras.io/api/callbacks/reduce_lr_on_plateau/">keras&#39;s</a> or <a href="https://pytorch.org/docs/stable/generated/torch.optim.lr_scheduler.ReduceLROnPlateau.html">pytorch&#39;s</a> implementations). To this end we introduce a <code>PlateauDetector</code> that tracks the target loss metric and updates learning rate in case it stops improving for a sufficient number of ticks.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>We will use the word <strong>tick</strong> to refer to a sequence of operations that results in <code>PlateauDetector</code> checking the loss metric precisely once. It is up to the user to decide how often that happens.</p></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Unlike <code>python</code>&#39;s <code>ReduceLROnPlateau</code> we don&#39;t restrict the reduction of the learning rate to be of the form of an exponential decay. Instead, we let the user choose the schedule along which the learning rate is being modified using the interface of <a href="https://fluxml.ai/ParameterSchedulers.jl/dev/api/general/#ParameterSchedulers.Stateful"><code>Stateful</code></a> defined in <a href="https://github.com/FluxML/ParameterSchedulers.jl">ParameterSchedulers.jl</a>. In particular, an exponential decay could be defined via:</p><pre><code class="language-julia hljs">using IMUDevNNTrainingLib
using ParameterSchedulers
using ParameterSchedulers: Stateful

init_learning_rate = 1e-3
decay = 0.7
scheduler = Stateful(Exp(init_learning_rate, decay))
pd = PlateauDetector(; scheduler)</code></pre></div></div><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="IMUDevNNTrainingLib.PlateauDetector" href="#IMUDevNNTrainingLib.PlateauDetector"><code>IMUDevNNTrainingLib.PlateauDetector</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">PlateauDetector(; patience=10, ϵ=1e-8,
                  scheduler=ParameterSchedulers.Stateful(Exp(0.001, 0.7))</code></pre><p>A plateau detector for schedulers of learning rate. It will adjust the learning rate when the loss has stopped improving for a number of ticks.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>Most commonly one tick is equal either to one epoch or one batch, but the user is free to define it as they see fit.</p></div></div><ul><li><code>patience::Int64</code>: The number of consecutive ticks with no improvement before advancing the learning rate along the scheduler.</li></ul><ul><li><code>last_tick::Int64</code>: <strong>Internal only.</strong> The last tick number on which the learning rate was adjusted.</li></ul><ul><li><code>best_loss::Float64</code>: <strong>Internal only.</strong> The best loss found so far.</li></ul><ul><li><code>best_tick::Int64</code>: <strong>Internal only.</strong> The tick number of the best loss found so far.</li></ul><ul><li><code>ϵ::Float64</code>: The minimum learning rate. If the learning rate is reduced to a value smaller than this, it will be clipped at this value.</li></ul><ul><li><code>scheduler::ParameterSchedulers.Stateful</code>: The schedule along which the learning rate will be adjusted.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/imu-dev/IMUDevNNTrainingLib.jl/blob/f53ac215aa508ddb692543f3db7fac13516fd955/src/plateau_detector.jl#L1-L13">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="IMUDevNNTrainingLib.step!" href="#IMUDevNNTrainingLib.step!"><code>IMUDevNNTrainingLib.step!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">step!(pd::PlateauDetector, loss::Real)</code></pre><p>Advance the plateau detector by one tick. Update <code>pd</code> internals with information about the current loss. Return <code>true</code> if the learning rate should be updated.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/imu-dev/IMUDevNNTrainingLib.jl/blob/f53ac215aa508ddb692543f3db7fac13516fd955/src/plateau_detector.jl#L56-L61">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Optimisers.adjust!" href="#Optimisers.adjust!"><code>Optimisers.adjust!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">Flux.Optimisers.adjust!(o, pd::PlateauDetector)</code></pre><p>Update the learning rate of the optimizer <code>o</code> according to the schedule defined by the plateau detector <code>pd</code>.</p><pre><code class="nohighlight hljs">Flux.Optimisers.adjust!(o, pd::PlateauDetector, i::Int)</code></pre><p>Reset the learning rate by moving to state <code>i</code> along the schedule defined by <code>pd.scheduler</code>.</p><pre><code class="nohighlight hljs">Flux.Optimisers.adjust!(o, pd::PlateauDetector, s::ParameterSchedulers.Stateful)</code></pre><p>Reset the learning rate by changing the scheduler to <code>s</code> and moving to the state defined by it.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>These last two three-parameter functions are sometimes convenient when we want to manually restart the learning rate schedule (for instance, after loading a checkpoint and restarting training).</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/imu-dev/IMUDevNNTrainingLib.jl/blob/f53ac215aa508ddb692543f3db7fac13516fd955/src/plateau_detector.jl#L78-L98">source</a></section></article><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>To avoid name clashes <code>step!</code> is not exported by <code>IMUDevNNTrainingLib</code>. It is recommended to use it as follows:</p><pre><code class="language-julia hljs">using IMUDevNNTrainingLib
using Flux
const NNTrLib = IMUDevNNTrainingLib
pd = PlateauDetector(; η=1e-4)
optimizer_state = ...
loss = ...
needs_update = NNTrLib.step!(pd, loss)
if needs_update
    Flux.adjust!(optimizer_state, pd)
end</code></pre></div></div><p>Additionally the following utility function is implemented:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="IMUDevNNTrainingLib.learning_rate" href="#IMUDevNNTrainingLib.learning_rate"><code>IMUDevNNTrainingLib.learning_rate</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">learning_rate(pd::PlateauDetector)</code></pre><p>Return the current learning rate of the plateau detector <code>pd</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/imu-dev/IMUDevNNTrainingLib.jl/blob/f53ac215aa508ddb692543f3db7fac13516fd955/src/plateau_detector.jl#L49-L53">source</a></section></article><p>An overloaded <code>Flux.adjust!</code> makes it possible to change the previously set schedules and adjust the state of the optimizer accordingly.</p><p>See also the <a href="https://github.com/imu-dev/IMUDevNNTrainingLib.jl/blob/main/examples/plateau_detector.jl">examples/plateau_detector.jl</a> file for more details on how to use a <code>PlateauDetector</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../checkpointer/">Checkpointer »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Saturday 2 March 2024 15:10">Saturday 2 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
